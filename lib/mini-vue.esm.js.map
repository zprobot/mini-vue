{"version":3,"file":"mini-vue.esm.js","sources":["../src/runtime-core/vnode.ts","../src/runtime-core/componentPublicInstance.ts","../src/runtime-core/component.ts","../src/runtime-core/renderer.ts","../src/runtime-core/createApp.ts","../src/runtime-core/h.ts"],"sourcesContent":["import { ShapeFlags } from \"../shared/ShapeFlags\"\n\nexport function createVNode(type, props?, children?) {\n\n    const vnode = {\n        type,\n        props,\n        children,\n        shapeFlag: getShapeFlag(type),\n        el: null\n    }\n    debugger\n    if(typeof children === 'string') {\n        vnode.shapeFlag |= ShapeFlags.TEXT_CHILDREN\n    }else if(Array.isArray(children)) {\n        vnode.shapeFlag |= ShapeFlags.ARRAY_CHILDREN\n    }\n    return vnode\n}\n\nfunction getShapeFlag(type) {\n    return typeof type === 'string' ? ShapeFlags.ELEMENT : ShapeFlags.STATEFUL_COMPONENT\n}","const publicPropertiesMap = {\n    $el: (i) => i.vnode.el\n}\nexport const PublicInstanceProxyHandlers = {\n    get({_: instance}, key) {\n        // steupState\n        const { setupState } = instance\n        if(key in setupState) {\n            return setupState[key]\n        }\n        // publicProp\n        const publicGetter = publicPropertiesMap[key]\n        if(publicGetter) {\n            return publicGetter(instance)\n        }\n\n    }\n}","import { PublicInstanceProxyHandlers } from \"./componentPublicInstance\"\n\nexport function createComponentInstance(vnode: any) {\n    const component = {\n        vnode,\n        type: vnode.type,\n        setupState: {}\n    }\n    return component\n}\nexport function setupComponent(instance) {\n    // initprops\n    // initSlots\n    setupStatefulComponent(instance)\n}\n\nfunction setupStatefulComponent(instance: any) {\n    const Component = instance.type\n    // ctx\n    instance.proxy = new Proxy({_:instance},PublicInstanceProxyHandlers)\n    const {setup} = Component\n    if(setup){\n        const setupResult = setup()\n        handleSetupResult(instance, setupResult)\n    }\n}\nfunction handleSetupResult(instance:any, setupResult: any) {\n    // function \n    // obj\n    if(typeof setupResult === 'object') {\n        instance.setupState = setupResult\n    }\n    finishComponentSetup(instance)\n}\n\nfunction finishComponentSetup(instance: any) {\n    const Component = instance.type\n    if(Component.render) {\n        instance.render = Component.render\n    }\n}\n\n","import { ShapeFlags } from \"../shared/ShapeFlags\"\nimport { createComponentInstance, setupComponent } from \"./component\"\n\nexport function render(vnode, container) {\n    patch(vnode, container)\n}\n\nfunction patch(vnode, container) {\n    // 处理组件\n    const { shapeFlag } = vnode\n    if(shapeFlag & ShapeFlags.ELEMENT) {\n        processElement(vnode, container)\n    } else if(shapeFlag & ShapeFlags.STATEFUL_COMPONENT) {\n        processComponent(vnode, container)\n    }\n}\nfunction processElement(vnode: any, container: any) {\n    mountElement(vnode, container)\n}\nfunction mountElement(vnode: any, container: any) {\n    const {type, props, children, shapeFlag} = vnode\n    const el = (vnode.el = document.createElement(type))\n    // children\n    if(shapeFlag & ShapeFlags.TEXT_CHILDREN) {\n        el.textContent = children\n    } else if (shapeFlag & ShapeFlags.ARRAY_CHILDREN) {\n        mountChildren(vnode,el)\n    }\n    for(const key of props) {\n        el.setAttribute(key,props[key])\n    }\n    container.append(el)\n}\nfunction mountChildren(vnode,container) {\n    vnode.children.forEach(v=>patch(v,container))\n}\nfunction processComponent(vnode: any, container: any) {\n    mountComponent(vnode, container)\n}\nfunction mountComponent(initialVnode: any,container: any) {\n    const instance = createComponentInstance(initialVnode)\n    setupComponent(instance)\n    setupRenderEffect(instance, initialVnode, container)\n}\n\n\n\nfunction setupRenderEffect(instance: any, initialVnode: any, container:any) {\n    const { proxy } = instance\n    const subTree = instance.render.call(proxy)\n    // vnode -> patch\n    // vnode -> element -> mountElement\n    patch(subTree,container)\n    // 所有组件都挂载\n    initialVnode.el = subTree.el\n}\n\n\n","import { createVNode } from \"./vnode\"\nimport { render } from \"./renderer\"\nexport function createApp(rootComponent) {\n    return {\n        mount(rootContainer) {\n            const vnode = createVNode(rootComponent)\n            render(vnode, rootContainer)\n        }\n    }\n}\n","import { createVNode } from \"./vnode\";\nexport function h(type, props?, children?) {\n    return createVNode(type,props,children)\n}"],"names":[],"mappings":"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"}